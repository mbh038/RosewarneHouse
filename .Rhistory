}
Q
}
Q<-Qt(R1,R2,Tm_init,C)
Qexp<-Qexp[-1]
plot(Qexp,type="l",ylim=c(min(min(Q),min(Qexp)),max(max(Q),max(Qexp))),xlab="Time (min)",ylab="Heat flux Q (W/m^2)",col="red")
lines(Q,col="blue")
legend("topright", c("Measured", "Predicted"), pch="o", col=c("red", "blue"))
legend("topright", c("Measured", "Predicted"), lwd=2, col=c("red", "blue"))
plot(t[index],Qexp[index],type="l",ylim=c(min(min(Q),min(Qexp)),max(max(Q),max(Qexp))),xlab="Time (min)",ylab="Heat flux Q (W/m^2)",col="red")
lines(t[index],Q[index],col="blue")
legend("topright", c("Measured", "Predicted"), lwd=2, col=c("red", "blue"))
plot(t[index]/1440,Qexp[index],
type="l",
ylim=c(min(min(Q[index]),min(Qexp[index])),max(max(Q[index]),max(Qexp[index]))),
xlab="Time (min)",
ylab="Heat flux Q (W/m^2)",
col="red")
lines(t[index]/1440,Q[index],col="blue")
legend("topright", c("Measured", "Predicted"), lwd=2, col=c("red", "blue"))
plot(t[index],Qexp[index],
type="l",
ylim=c(min(min(Q[index]),min(Qexp[index])),max(max(Q[index]),max(Qexp[index]))),
xlab="Time (min)",
ylab="Heat flux Q (W/m^2)",
col="red")
lines(t[index],Q[index],col="blue")
legend("topright", c("Measured", "Predicted"), lwd=2, col=c("red", "blue"))
plot(t[index],Qexp[index],
type="l",
ylim=c(min(min(Q),min(Qexp)),max(max(Q),max(Qexp))),
xlab="Time (min)",
ylab="Heat flux Q (W/m^2)",
col="red")
lines(t[index],Q[index],col="blue")
legend("topright", c("Measured", "Predicted"), lwd=2, col=c("red", "blue"))
plot(t[index],Qexp[index],
type="l",
ylim=c(-10,25),
xlab="Time (min)",
ylab="Heat flux Q (W/m^2)",
col="red")
lines(t[index],Q[index],col="blue")
legend("topright", c("Measured", "Predicted"), lwd=2, col=c("red", "blue"))
plot(t[index],Qexp[index],
type="l",
ylim=c(-15,20),
xlab="Time (min)",
ylab="Heat flux Q (W/m^2)",
col="red")
lines(t[index],Q[index],col="blue")
legend("topright", c("Measured", "Predicted"), lwd=2, col=c("red", "blue"))
plot(t[index],Qexp[index],
type="l",
ylim=c(-15,20),
xlab="Time (min)",
ylab="Heat flux Q (W/m^2)",
col=COL[1])
lines(t[index],Q[index],col=COL[2])
legend("topright", c("Measured", "Predicted"), lwd=2, col=c(COL[1], COL[2]))
plot(t[index],Qexp[index],
type="l",
ylim=c(-5,20),
xlab="Time (min)",
ylab="Heat flux Q (W/m^2)",
col=COL[1])
lines(t[index],Q[index],col=COL[2])
legend("topright", c("Measured", "Predicted"), lwd=2, col=c(COL[1], COL[2]))
plot(t[index]/1440,Qexp[index],
type="l",
ylim=c(-5,20),
xlab="Time (min)",
ylab="Heat flux Q (W/m^2)",
col=COL[1])
lines(t[index]/1440,Q[index],col=COL[2])
legend("topright", c("Measured", "Predicted"), lwd=2, col=c(COL[1], COL[2]))
plot(t[index]/1440,Qexp[index],
type="l",
ylim=c(-5,20),
xlab="Time (days)",
ylab="Heat flux Q (W/m^2)",
col=COL[1])
lines(t[index]/1440,Q[index],col=COL[2])
legend("topright", c("Measured", "Predicted"), lwd=2, col=c(COL[1], COL[2]))
source('C:/Users/Mike/Rspace/RosewarneHouse/PlotRHFigures.r', echo=TRUE)
source('C:/Users/Mike/Rspace/RosewarneHouse/PlotRHFigures.r', echo=TRUE)
source('C:/Users/Mike/Rspace/RosewarneHouse/PlotRHFigures.r', echo=TRUE)
LL <- function(R1,R2,Tm_init,C, mu, sigma) {
R = Qexp-Qt(R1,R2,Tm_init,C)
#
R = suppressWarnings(dnorm(R, mu, sigma, log = TRUE))
#
-sum(R)
}
library(stats4)
fit1<-mle(LL,
start = list(R1=1.7,R2=0.804,Tm_init=15.4,C=1364000,sigma=1),
fixed=list(mu=0),
nobs = length(Q),
lower = c(1.5, .5,14,1000000,0.1),
upper = c(2,1.5,17,2000000,5),
method= "L-BFGS-B"
)
mypar(1,1)
R1=1.8
R2=0.804
C=1364000
Tm_init=15.08
tau=60
Qt<-function(R1,R2,Tm_init,C){
Tm[1]=Tm_init
for (i in 1:(length(t)-1)){
dt=60*(t[i+1]-t[i])
Q[i]=(Tint[i]-Tm[i])/R1
Tm[i+1]=((Tint[i+1]/R1)+(Text[i+1]/R2)+C*Tm[i]/dt)/(1/R1 + 1/R2 + C/dt)
}
Q
}
Q<-Qt(R1,R2,Tm_init,C)
Qexp<-Qexp[-1]
plot(t[index]/1440,Qexp[index],
type="l",
ylim=c(-5,20),
xlab="Time (days)",
ylab="Heat flux Q (W/m^2)",
col=COL[1])
lines(t[index]/1440,Q[index],
col=COL[2])
legend("topright",
c("Measured", "Predicted"),
lwd=2,
col=c(COL[1], COL[2])
)
png("./figures/heatflux_U1.png",width=595,height=642)
plot(t[index]/1440,Qexp[index],
type="l",
ylim=c(-5,20),
xlab="Time (days)",
ylab="Heat flux Q (W/m^2)",
col=COL[1])
lines(t[index]/1440,Q[index],
col=COL[2])
legend("topright",
c("Measured", "Predicted"),
lwd=2,
col=c(COL[1], COL[2])
)
dev.off()
png("./figures/heatflux_U1.png",width=595,height=642)
plot(t[index]/1440,Qexp[index],
type="l",
ylim=c(-5,20),
xlab="Time (days)",
ylab="Heat flux Q (W/m^2)",
col=COL[1])
lines(t[index]/1440,Q[index],
col=COL[2])
legend("topright",
c("Measured", "Predicted"),
lwd=2,
col=c(COL[1], COL[2])
)
text("bottomleft","Unit 1")
dev.off()
png("./figures/heatflux_U1.png",width=595,height=642)
plot(t[index]/1440,Qexp[index],
type="l",
ylim=c(-5,20),
xlab="Time (days)",
ylab="Heat flux Q (W/m^2)",
col=COL[1])
lines(t[index]/1440,Q[index],
col=COL[2])
legend("topright",
c("Measured", "Predicted"),
lwd=2,
col=c(COL[1], COL[2])
)
text(0,-5,"Unit 1")
dev.off()
png("./figures/heatflux_U1.png",width=595,height=642)
plot(t[index]/1440,Qexp[index],
type="l",
ylim=c(-5,20),
xlab="Time (days)",
ylab="Heat flux Q (W/m^2)",
col=COL[1])
lines(t[index]/1440,Q[index],
col=COL[2])
legend("topright",
c("Measured", "Predicted"),
lwd=2,
col=c(COL[1], COL[2])
)
text(0,-5,"Unit 1",pos=4)
dev.off()
png("./figures/temperatures_U1.png",width=595,height=642)
plot(days,tin,
type="l",
col=COL[4],
ylim=c(0,30),
xlab="Time (days)",
ylab="Temperature (deg celsius)")
lines(days,tout,col=COL[1])
legend("topright",
c("Interior wall surface", "Exterior wall surface"),
lwd=2,
col=c(COL[1], COL[2])
)
dev.off()
png("./figures/temperatures_U1.png",width=595,height=642)
plot(days,tin,
type="l",
col=COL[4],
ylim=c(0,30),
xlab="Time (days)",
ylab="Temperature (deg celsius)")
lines(days,tout,col=COL[1])
legend("topright",
c("Interior wall surface", "Exterior wall surface"),
lwd=2,
col=c(COL[4], COL[1])
)
dev.off()
u4<-read.csv("22-04-to-29-04 unit4 final.prn",sep="\t",stringsAsFactors=FALSE)
id<-seq(1,nrow(u4))
u4<-cbind(id,u4)
names(u4)<-c("id","date","time","T1","T2","T3","T4","hp1","hp2")
tin<-u4$T1
tin<-SMA(tin,5)
tout<-u4$T4
tout<-SMA(tout,5)
library(TTR)
library(rafalib)
library(openintro)
data(COL)
mypar(1,1)
days<-seq(1,nrow(u1))/1440
png("./figures/temperatures_U4.png",width=595,height=642)
plot(days,tin,
type="l",
col=COL[4],
ylim=c(0,30),
xlab="Time (days)",
ylab="Temperature (deg celsius)")
lines(days,tout,col=COL[1])
legend("topright",
c("Interior wall surface", "Exterior wall surface"),
lwd=2,
col=c(COL[4], COL[1])
)
dev.off()
days<-seq(1,nrow(u4))/1440
png("./figures/temperatures_U4.png",width=595,height=642)
plot(days,tin,
type="l",
col=COL[4],
ylim=c(0,30),
xlab="Time (days)",
ylab="Temperature (deg celsius)")
lines(days,tout,col=COL[1])
legend("topright",
c("Interior wall surface", "Exterior wall surface"),
lwd=2,
col=c(COL[4], COL[1])
)
dev.off()
png("./figures/temperatures_U4.png",width=595,height=642)
plot(days,tin,
type="l",
col=COL[4],
ylim=c(0,30),
xlab="Time (days)",
ylab="Temperature (deg celsius)")
lines(days,tout,col=COL[1])
legend("topright",
c("Interior wall surface", "Exterior wall surface"),
lwd=2,
col=c(COL[4], COL[1])
)
text(0,0,"Unit 4 (A)")
dev.off()
png("./figures/temperatures_U4.png",width=595,height=642)
plot(days,tin,
type="l",
col=COL[4],
ylim=c(0,30),
xlab="Time (days)",
ylab="Temperature (deg celsius)")
lines(days,tout,col=COL[1])
legend("topright",
c("Interior wall surface", "Exterior wall surface"),
lwd=2,
col=c(COL[4], COL[1])
)
text(0,0,"Unit 4 (A)".pos=4)
dev.off()
png("./figures/temperatures_U4.png",width=595,height=642)
plot(days,tin,
type="l",
col=COL[4],
ylim=c(0,30),
xlab="Time (days)",
ylab="Temperature (deg celsius)")
lines(days,tout,col=COL[1])
legend("topright",
c("Interior wall surface", "Exterior wall surface"),
lwd=2,
col=c(COL[4], COL[1])
)
text(0,0,"Unit 4 (A)",pos=4)
dev.off()
# read in Unit 1 data
u1<-read.csv("18-03-to-15-04 unit1.prn",sep="\t",stringsAsFactors=FALSE)
id<-seq(1,nrow(u1))
u1<-cbind(id,u1)
names(u1)<-c("id","date","time","T1","T2","T3","T4","hp1","hp2")
library(TTR)
library(rafalib)
library(openintro)
data(COL)
mypar(1,1)
# plot(u1$T2,type="l",col=COL[1]) # outside
# lines(u1$T4,col=COL[2]) # outside
# lines(u1$T1,col=COL[3]) # inside
# lines(u1$T3,col=COL[4]) # inside
tin<-(u1$T1+u1$T3)/2
tin<-SMA(tin,5)
tout<-(u1$T2+u1$T4)/2
tout<-SMA(tout,5)
days<-seq(1,nrow(u1))/1440
png("./figures/temperatures_U1.png",width=595,height=642)
plot(days,tin,
type="l",
col=COL[4],
ylim=c(0,30),
xlab="Time (days)",
ylab="Temperature (deg celsius)")
lines(days,tout,col=COL[1])
legend("topright",
c("Interior wall surface", "Exterior wall surface"),
lwd=2,
col=c(COL[4], COL[1])
)
text(0,0,"Unit 1 (D)",pos=4)
dev.off()
u4<-read.csv("22-04-to-29-04 unit4 final.prn",sep="\t",stringsAsFactors=FALSE)
id<-seq(1,nrow(u4))
u4<-cbind(id,u4)
names(u4)<-c("id","date","time","T1","T2","T3","T4","hp1","hp2")
tin<-u4$T1
tin<-SMA(tin,5)
tout<-u4$T4
tout<-SMA(tout,5)
library(TTR)
library(rafalib)
library(openintro)
data(COL)
mypar(1,1)
days<-seq(1,nrow(u4))/1440
png("./figures/temperatures_U4.png",width=595,height=642)
plot(days,tin,
type="l",
col=COL[4],
ylim=c(0,30),
xlab="Time (days)",
ylab="Temperature (deg celsius)")
lines(days,tout,col=COL[1])
legend("topright",
c("Interior wall surface", "Exterior wall surface"),
lwd=2,
col=c(COL[4], COL[1])
)
text(0,0,"Unit 4 (A)",pos=4)
dev.off()
#index=u4$T2-u4$T4>-1 & u4$T2-u4$T4<0
# heat plate plots
u4$hp1preamp1<-ampch1(u4$hp1)
u4$hp1flux1<-u4$hp1preamp1/0.06
u4$hp2preamp2<-ampch2(u4$hp2)
u4$hp2flux2<-u4$hp2preamp2/0.06
index=2000:10000
# plot(u4$T1[index]-u4$T4[index],type="l")
# lines(u4$T2[index]-u4$T4[index],col="blue")
#
# plot(u4$hp1flux1,type="l")
# plot(u4$hp2flux2,type="l",col="blue")
#
# plot(u4$id[index],u4$hp1flux1[index],type="l",ylim=c(-10,10))
# plot(u4$id[index],u4$hp2flux2[index],col="blue",type="l",ylim=c(0,20))
Qexp<-u4$hp2flux2[index]
Tint<-tin[index]
Text<-tout[index]
t=u4$id[index]
Tm=numeric()
Q=numeric()
mypar(1,1)
R1=2.9 # celotex
R2=0.804 # as per unit 1, stone wall
C=1364000
Tm_init=15.08
tau=60
Qt<-function(R1,R2,Tm_init,C){
Tm[1]=Tm_init
for (i in 1:length(t)){
dt=60*(t[i+1]-t[i])
Q[i]=(Tint[i]-Tm[i])/R1
Tm[i+1]=((Tint[i+1]/R1)+(Text[i+1]/R2)+C*Tm[i]/dt)/(1/R1 + 1/R2 + C/dt)
}
Q
}
Q<-Qt(R1,R2,Tm_init,C)
#Qexp<-Qexp[-1]
Qexp<-Qexp+mean(Q-Qexp)
png("./figures/heatflux_U4.png",width=595,height=642)
plot(t[index]/1440,Qexp[index],
type="l",
ylim=c(-5,20),
xlab="Time (days)",
ylab="Heat flux Q (W/m^2)",
col=COL[1])
lines(t[index]/1440,Q[index],
col=COL[2])
legend("topright",
c("Measured", "Predicted"),
lwd=2,
col=c(COL[1], COL[2])
)
text(0,-5,"Unit 4",pos=4)
dev.off()
png("./figures/heatflux_U4.png",width=595,height=642)
plot(t[index]/1440,Qexp[index],
type="l",
ylim=c(0,5),
xlab="Time (days)",
ylab="Heat flux Q (W/m^2)",
col=COL[1])
lines(t[index]/1440,Q[index],
col=COL[2])
legend("topright",
c("Measured", "Predicted"),
lwd=2,
col=c(COL[1], COL[2])
)
text(0,-5,"Unit 4",pos=4)
dev.off()
png("./figures/heatflux_U4.png",width=595,height=642)
plot(t[index]/1440,Qexp[index],
type="l",
ylim=c(0,3),
xlab="Time (days)",
ylab="Heat flux Q (W/m^2)",
col=COL[1])
lines(t[index]/1440,Q[index],
col=COL[2])
legend("topright",
c("Measured", "Predicted"),
lwd=2,
col=c(COL[1], COL[2])
)
text(0,-5,"Unit 4",pos=4)
dev.off()
png("./figures/heatflux_U4.png",width=595,height=642)
plot(t[index]/1440,Qexp[index],
type="l",
ylim=c(0,3),
xlab="Time (days)",
ylab="Heat flux Q (W/m^2)",
col=COL[1])
lines(t[index]/1440,Q[index],
col=COL[2])
legend("topright",
c("Measured", "Predicted"),
lwd=2,
col=c(COL[1], COL[2])
)
text(0,0,"Unit 4",pos=4)
dev.off()
png("./figures/heatflux_U4.png",width=595,height=642)
plot(t[index]/1440,Qexp[index],
type="l",
ylim=c(0,3),
xlab="Time (days)",
ylab="Heat flux Q (W/m^2)",
col=COL[1])
lines(t[index]/1440,Q[index],
col=COL[2])
legend("topright",
c("Measured", "Predicted"),
lwd=2,
col=c(COL[1], COL[2])
)
text(3,0,"Unit 4",pos=4)
dev.off()
png("./figures/heatflux_U4.png",width=595,height=642)
plot(t[index]/1440,Qexp[index],
type="l",
ylim=c(0,3),
xlab="Time (days)",
ylab="Heat flux Q (W/m^2)",
col=COL[1])
lines(t[index]/1440,Q[index],
col=COL[2])
legend("topright",
c("Measured", "Predicted"),
lwd=2,
col=c(COL[1], COL[2])
)
text(3,0,"Unit 4 (A), R = 3.7",pos=4)
dev.off()
1/3.7
source('C:/Users/Mike/Rspace/RosewarneHouse/PlotRHFigures.r', echo=TRUE)
